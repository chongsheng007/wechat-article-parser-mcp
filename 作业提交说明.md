# 微信公众号文章解析 MCP 应用 - 作业提交

## 📋 项目信息

**项目名称**: 微信公众号文章解析 MCP Server  
**项目类型**: MCP (Model Context Protocol) 服务器  
**开发框架**: FastMCP 2.13.0.2  
**编程语言**: Python 3.10+

---

## 🔗 代码仓库

**GitHub 仓库地址**: https://github.com/chongsheng007/wechat-article-parser-mcp

### 项目结构

```
src/wechat_article_parser/
├── __init__.py
├── server.py                    # MCP 服务器主文件
├── wechat_server.py            # 入口文件（用于 fastmcp dev）
├── tools/                       # 工具实现
│   ├── parse_article.py        # 解析文章工具
│   ├── extract_metadata.py     # 提取元数据工具
│   └── extract_images.py       # 提取图片工具
├── utils/                       # 工具函数
│   ├── parser.py               # 文章解析核心逻辑
│   ├── html_extractor.py      # HTML 提取器
│   ├── formatters.py           # 格式化器
│   └── errors.py               # 错误处理
└── pyproject.toml              # 项目依赖配置
```

---

## ✨ 核心功能

### 1. 文章解析工具 (`parse_wechat_article_tool`)

- **功能**: 完整解析微信公众号文章，提取所有内容
- **输出格式**: 支持 Markdown、Text、HTML 三种格式
- **特性**:
  - 提取文章标题、作者、发布时间等元数据
  - 提取完整正文内容（支持格式化）
  - 提取所有图片（可嵌入 Markdown）
  - 提取所有外部链接
  - 统计文章字数、图片数量、链接数量

### 2. 元数据提取工具 (`extract_article_metadata`)

- **功能**: 快速提取文章元数据（不解析全文）
- **提取内容**:
  - 标题
  - 作者
  - 发布时间
  - 封面图 URL

### 3. 图片提取工具 (`extract_article_images`)

- **功能**: 提取文章中的所有图片
- **特性**:
  - 支持包含/排除封面图
  - 支持按格式过滤（jpg、png、gif）
  - 返回所有图片的 URL 列表

---

## 🛠️ 技术实现

### 核心技术栈

- **FastMCP**: MCP 服务器框架
- **BeautifulSoup4**: HTML 解析
- **requests**: HTTP 请求
- **html2text**: HTML 转 Markdown
- **Pydantic**: 数据验证

### 关键技术点

1. **HTML 解析**: 使用 BeautifulSoup 解析微信公众号文章 HTML 结构
2. **图片处理**: 支持懒加载图片（`data-src`、`data-original` 等属性）
3. **URL 处理**: 自动将相对路径转换为绝对路径
4. **错误处理**: 完善的错误提示和异常处理机制
5. **格式转换**: 支持多种输出格式（Markdown、Text、HTML）

---

## 📦 安装与配置

### 1. 克隆代码仓库

```bash
git clone https://github.com/chongsheng007/wechat-article-parser-mcp.git
cd wechat-article-parser-mcp/src/wechat_article_parser
```

### 2. 安装依赖

```bash
# 使用 uv（推荐）
uv sync

# 或使用 pip
pip install -r requirements.txt
```

### 3. 配置 Cursor MCP

编辑 `~/.cursor/mcp.json`，添加以下配置：

```json
{
  "mcpServers": {
    "wechat-article-parser": {
      "command": "uv",
      "args": [
        "run",
        "--directory",
        "/path/to/your/project/src/wechat_article_parser",
        "python",
        "/path/to/your/project/src/wechat_article_parser/wechat_server.py"
      ],
      "disabled": false
    }
  }
}
```

### 4. 重启 Cursor

重启 Cursor IDE 后，MCP 工具即可使用。

---

## 🎯 使用示例

### 在 Cursor 中直接使用

```
请解析这篇微信公众号文章：https://mp.weixin.qq.com/s/xxx
```

### 工具调用示例

1. **解析完整文章**:
   - `parse_wechat_article_tool(url="https://mp.weixin.qq.com/s/...", format="markdown")`

2. **提取元数据**:
   - `extract_article_metadata(url="https://mp.weixin.qq.com/s/...")`

3. **提取图片**:
   - `extract_article_images(url="https://mp.weixin.qq.com/s/...", include_cover=True)`

---

## 📊 测试结果

### 测试文章

**URL**: https://mp.weixin.qq.com/s/MARhfmo921-eVd_koJZgGw

### 测试结果

✅ **文章解析**: 成功提取完整文章内容（4407 字）  
✅ **元数据提取**: 成功提取标题、作者、封面图  
✅ **图片提取**: 成功提取 15 张图片（1 张封面 + 14 张正文）  
✅ **格式转换**: Markdown 格式输出正常  
✅ **错误处理**: 异常情况处理正常

（测试结果截图已单独提交）

---

## 🔧 技术亮点

1. **参数传递优化**: 使用独立函数参数而非 Pydantic 模型，提升与 Cursor 的兼容性
2. **懒加载图片处理**: 支持多种懒加载属性（`data-src`、`data-original`、`data-src-s`、`data-lazy-src`）
3. **相对路径转换**: 自动将相对 URL 转换为绝对 URL
4. **错误提示完善**: 提供详细的错误信息和解决建议
5. **代码结构清晰**: 模块化设计，易于维护和扩展

---

## 📝 开发说明

### 项目特点

- ✅ 完全遵循 MCP 协议规范
- ✅ 使用 FastMCP 框架，代码简洁高效
- ✅ 完善的错误处理和用户提示
- ✅ 支持多种输出格式
- ✅ 代码结构清晰，易于扩展

### 主要文件说明

- `wechat_server.py`: MCP 服务器入口文件，处理相对导入问题
- `server.py`: 主服务器文件，注册所有工具
- `tools/`: 三个核心工具的实现
- `utils/`: 核心解析逻辑和辅助函数

---

## 📄 许可证

本项目为学习项目，供课程作业使用。

---

## 👨‍💻 作者

开发完成时间: 2025年11月

---

## 📌 提交说明

**代码仓库**: https://github.com/chongsheng007/wechat-article-parser-mcp  
**测试截图**: 已单独提交

项目代码已完整上传至 GitHub，可直接访问查看源代码。

